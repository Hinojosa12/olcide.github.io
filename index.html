<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Presupuesto Mensual</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Paleta de colores rosa pastel */
            --rosa-pastel-claro: #fff0f5;     /* Fondo principal - rosa pastel muy claro */
            --rosa-pastel-medio: #ffd6e7;     /* Fondo de tablas - rosa un poco más fuerte */
            --rosa-pastel-fuerte: #ffc2d6;    /* Bordes y detalles */
            --rosa-pastel-oscuro: #ff8fab;    /* Para hover y efectos */
            
            /* Colores funcionales */
            --primary: #ff6b9d;               /* Rosa más intenso para botones */
            --secondary: #d81b60;             /* Rosa oscuro para hover */
            --income-color: #2e8b57;          /* Verde para ingresos */
            --expense-color: #c71585;         /* Rosa fuerte para gastos */
            --text-primary: #5a3d5c;          /* Texto principal - morado suave */
            --text-secondary: #7a5c7c;        /* Texto secundario */
            --border-color: #ffb6c1;          /* Bordes rosas claros */
            --table-header: #ffe4ec;          /* Encabezados de tabla */
            --header-color: #9d4b6e;          /* Color de encabezados */
        }
       
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
       
        body {
            background-color: var(--rosa-pastel-claro);
            color: var(--text-primary);
            padding: 0;
            margin: 0;
            min-height: 100vh;
            line-height: 1.4;
        }
       
        .container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
            margin: 0 auto;
        }
       
        header {
            background: linear-gradient(135deg, var(--rosa-pastel-fuerte), var(--rosa-pastel-oscuro));
            color: white;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.2);
        }
       
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
       
        h2 {
            font-size: 22px;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--rosa-pastel-fuerte);
            color: var(--header-color);
        }
       
        /* ESTILOS CURSIVOS PARA TÍTULOS ESPECÍFICOS */
        .titulo-cursivo {
            font-style: italic !important;
            font-weight: 600;
        }
       
        .budget-section {
            background: var(--rosa-pastel-medio);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(255, 182, 193, 0.3);
            border: 1px solid var(--rosa-pastel-fuerte);
        }
       
        /* ESTILOS DE TABLA */
        .budget-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 16px;
            background-color: var(--rosa-pastel-medio);
            border-radius: 8px;
            overflow: hidden;
        }
       
        .budget-table th {
            background-color: var(--table-header);
            padding: 14px 10px;
            text-align: left;
            font-weight: bold;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 16px;
        }
       
        .budget-table td {
            padding: 12px 10px;
            border: 1px solid var(--border-color);
            background-color: rgba(255, 255, 255, 0.7);
        }
       
        .budget-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            transition: all 0.3s;
        }
       
        .budget-table input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
            background-color: white;
        }
       
        .budget-table input[type="date"] {
            cursor: pointer;
        }
       
        .budget-table input[type="number"] {
            text-align: right;
        }
       
        .subtotal {
            font-weight: bold;
            background-color: rgba(255, 228, 236, 0.8) !important;
        }
       
        .total-row {
            font-weight: bold;
            font-size: 18px;
            background-color: var(--table-header) !important;
        }
       
        /* Sección de resumen */
        .summary {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
        }
       
        .summary-item {
            background: var(--rosa-pastel-medio);
            padding: 25px;
            border-radius: 10px;
            flex: 1;
            min-width: 200px;
            margin: 0 10px 20px 10px;
            box-shadow: 0 3px 10px rgba(255, 182, 193, 0.3);
            border: 1px solid var(--rosa-pastel-fuerte);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
       
        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 182, 193, 0.4);
        }
       
        .summary-item h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
       
        .summary-amount {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
       
        .income-amount {
            color: var(--income-color);
        }
       
        .expense-amount {
            color: var(--expense-color);
        }
       
        .balance-amount {
            color: var(--primary);
        }
       
        /* Controles de acción */
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
       
        .control-btn {
            background: linear-gradient(to right, var(--primary), var(--rosa-pastel-oscuro));
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(255, 107, 157, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
       
        .control-btn:hover {
            background: linear-gradient(to right, var(--secondary), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(255, 107, 157, 0.4);
        }
       
        .control-btn i {
            font-size: 18px;
        }
       
        .control-btn.secondary {
            background: linear-gradient(to right, #ff8fab, #ff6b9d);
        }
       
        .control-btn.secondary:hover {
            background: linear-gradient(to right, #ff6b9d, #d81b60);
        }
       
        .month-selector {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            background-color: var(--rosa-pastel-medio);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--rosa-pastel-fuerte);
        }
       
        .month-selector label {
            margin-right: 10px;
            font-weight: bold;
            color: var(--text-primary);
        }
       
        .month-selector select {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: white;
            font-size: 16px;
            color: var(--text-primary);
            cursor: pointer;
        }
       
        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 2px solid var(--rosa-pastel-fuerte);
            background-color: var(--rosa-pastel-medio);
            border-radius: 10px;
        }
       
        /* Gastos extras */
        #gastos-extras-section {
            background-color: var(--rosa-pastel-medio);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid var(--rosa-pastel-fuerte);
        }
       
        #lista-gastos-extras {
            margin-bottom: 20px;
        }
       
        #nuevo-gasto-desc, #nuevo-gasto-monto {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: white;
            color: var(--text-primary);
        }
       
        #nuevo-gasto-desc {
            width: 300px;
            margin-right: 10px;
        }
       
        #nuevo-gasto-monto {
            width: 150px;
            margin-right: 10px;
        }
       
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
           
            .summary {
                flex-direction: column;
            }
           
            .summary-item {
                margin: 0 0 15px 0;
            }
           
            .controls {
                flex-direction: column;
            }
           
            .control-btn {
                width: 100%;
                margin-bottom: 10px;
            }
           
            .budget-table {
                font-size: 14px;
            }
           
            .budget-table th,
            .budget-table td {
                padding: 10px 8px;
            }
           
            #nuevo-gasto-desc {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
           
            #nuevo-gasto-monto {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
           
            .month-selector {
                flex-direction: column;
                align-items: flex-start;
            }
           
            .month-selector label {
                margin-bottom: 10px;
            }
           
            .month-selector select {
                width: 100%;
                margin-bottom: 10px;
            }
        }
       
        /* Animación para cambios en números */
        @keyframes cambioNumero {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
       
        .cambio-destacado {
            animation: cambioNumero 0.5s ease;
        }
       
        /* Estilos para el saldo negativo */
        .saldo-negativo {
            color: var(--expense-color) !important;
            font-weight: bold;
        }
       
        /* Decoración floral */
        .floral-decoration {
            position: fixed;
            z-index: -1;
            opacity: 0.1;
            font-size: 200px;
            color: var(--primary);
        }
       
        .floral-1 {
            top: 50px;
            left: 50px;
            transform: rotate(-15deg);
        }
       
        .floral-2 {
            bottom: 50px;
            right: 50px;
            transform: rotate(15deg);
        }
    </style>
</head>
<body>
    <!-- Decoraciones florales de fondo -->
    <div class="floral-decoration floral-1">
        <i class="fas fa-heart"></i>
    </div>
    <div class="floral-decoration floral-2">
        <i class="fas fa-heart"></i>
    </div>
    
    <div class="container">
        <header>
            <h1>Presupuesto Mensual</h1>
            <p>Controla tus ingresos y gastos con estilo</p>
        </header>
       
        <div class="month-selector">
            <label for="select-month">Mes:</label>
            <select id="select-month">
                <option value="1">Enero</option>
                <option value="2">Febrero</option>
                <option value="3">Marzo</option>
                <option value="4">Abril</option>
                <option value="5">Mayo</option>
                <option value="6">Junio</option>
                <option value="7">Julio</option>
                <option value="8">Agosto</option>
                <option value="9">Septiembre</option>
                <option value="10">Octubre</option>
                <option value="11">Noviembre</option>
                <option value="12">Diciembre</option>
            </select>
            <select id="select-year" style="margin-left: 10px;">
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
            </select>
        </div>
       
        <!-- SECCIÓN DE INGRESOS -->
        <div class="budget-section">
            <h2 class="titulo-cursivo">(+) <i>Ingresos</i>:</h2>
            <table class="budget-table">
                <thead>
                    <tr>
                        <th style="width: 120px;">Fecha</th>
                        <th>Descripción</th>
                        <th style="width: 150px;">Estimado</th>
                        <th style="width: 150px;">Real</th>
                    </tr>
                </thead>
                <tbody id="ingresos-body">
                    <!-- Sueldo -->
                    <tr>
                        <td><input type="date" id="fecha-sueldo"></td>
                        <td>Sueldo</td>
                        <td><input type="number" id="estimado-sueldo" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-sueldo" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Trabajo extra -->
                    <tr>
                        <td><input type="date" id="fecha-extra"></td>
                        <td>Trabajo extra</td>
                        <td><input type="number" id="estimado-extra" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-extra" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Inversiones -->
                    <tr>
                        <td><input type="date" id="fecha-inversiones"></td>
                        <td>Inversiones</td>
                        <td><input type="number" id="estimado-inversiones" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-inversiones" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Suma de ingresos -->
                    <tr class="subtotal">
                        <td colspan="2" style="text-align: right; font-style: italic;">Suma de <i>ingresos</i>:</td>
                        <td id="total-ingresos-estimado">$0.00</td>
                        <td id="total-ingresos-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- SECCIÓN DE GASTOS -->
        <div class="budget-section">
            <h2 class="titulo-cursivo">(-) <i>Gastos</i>:</h2>
            <table class="budget-table">
                <thead>
                    <tr>
                        <th style="width: 120px;">Fecha</th>
                        <th>Descripción</th>
                        <th style="width: 150px;">Estimado</th>
                        <th style="width: 150px;">Real</th>
                    </tr>
                </thead>
                <tbody id="gastos-body">
                    <!-- Servicios básicos -->
                    <tr>
                        <td><input type="date" id="fecha-luz"></td>
                        <td>Servicio de luz</td>
                        <td><input type="number" id="estimado-luz" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-luz" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <tr>
                        <td><input type="date" id="fecha-agua"></td>
                        <td>Servicio de agua</td>
                        <td><input type="number" id="estimado-agua" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-agua" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <tr>
                        <td><input type="date" id="fecha-internet"></td>
                        <td>Internet y telefonía</td>
                        <td><input type="number" id="estimado-internet" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-internet" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Alimentación -->
                    <tr>
                        <td><input type="date" id="fecha-alimentacion"></td>
                        <td>Alimentación</td>
                        <td><input type="number" id="estimado-alimentacion" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-alimentacion" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Ahorro -->
                    <tr>
                        <td><input type="date" id="fecha-ahorro"></td>
                        <td>Ahorro</td>
                        <td><input type="number" id="estimado-ahorro" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-ahorro" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Otros -->
                    <tr>
                        <td><input type="date" id="fecha-otros"></td>
                        <td>Otros</td>
                        <td><input type="number" id="estimado-otros" placeholder="0.00" step="0.01"></td>
                        <td><input type="number" id="real-otros" placeholder="0.00" step="0.01"></td>
                    </tr>
                    <!-- Suma de gastos -->
                    <tr class="subtotal">
                        <td colspan="2" style="text-align: right; font-style: italic;">Suma de <i>gastos</i>:</td>
                        <td id="total-gastos-estimado">$0.00</td>
                        <td id="total-gastos-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- SECCIÓN DE SALDO NETO -->
        <div class="budget-section">
            <h2>(-) Saldo Neto:</h2>
            <table class="budget-table">
                <tbody>
                    <tr class="total-row">
                        <td colspan="2" style="text-align: right;">Saldo Neto del Mes:</td>
                        <td id="saldo-estimado">$0.00</td>
                        <td id="saldo-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- RESUMEN RÁPIDO -->
        <div class="summary">
            <div class="summary-item">
                <h3><i>Ingresos</i> Totales</h3>
                <div class="summary-amount income-amount" id="resumen-ingresos">$0.00</div>
                <p>Este mes</p>
            </div>
            <div class="summary-item">
                <h3><i>Gastos</i> Totales</h3>
                <div class="summary-amount expense-amount" id="resumen-gastos">$0.00</div>
                <p>Este mes</p>
            </div>
            <div class="summary-item">
                <h3>Saldo Final</h3>
                <div class="summary-amount balance-amount" id="resumen-saldo">$0.00</div>
                <p>Disponible</p>
            </div>
        </div>
       
        <!-- CONTROLES -->
        <div class="controls">
            <button class="control-btn" id="btn-guardar">
                <i class="fas fa-save"></i> Guardar Presupuesto
            </button>
            <button class="control-btn secondary" id="btn-cargar">
                <i class="fas fa-folder-open"></i> Cargar Mes
            </button>
            <button class="control-btn secondary" id="btn-limpiar">
                <i class="fas fa-broom"></i> Limpiar Todo
            </button>
            <button class="control-btn secondary" id="btn-agregar-gasto">
                <i class="fas fa-plus-circle"></i> Agregar Gasto Extra
            </button>
        </div>
       
        <!-- LISTA DE GASTOS EXTRAS -->
        <div class="budget-section" id="gastos-extras-section" style="display: none;">
            <h2><i>Gastos</i> Extras:</h2>
            <div id="lista-gastos-extras">
                <!-- Los gastos extras se agregarán aquí dinámicamente -->
            </div>
            <div style="margin-top: 15px;">
                <input type="text" id="nuevo-gasto-desc" placeholder="Descripción del gasto">
                <input type="number" id="nuevo-gasto-monto" placeholder="Monto" step="0.01">
                <button class="control-btn" id="btn-agregar-gasto-lista" style="padding: 10px 20px; display: inline-block;">
                    <i class="fas fa-plus"></i> Agregar
                </button>
            </div>
        </div>
       
        <footer>
            <p>Presupuesto Mensual &copy; 2026 | Controla tus finanzas con estilo y organización</p>
            <p style="margin-top: 10px; font-size: 12px; color: var(--rosa-pastel-oscuro);">
                <i class="fas fa-heart" style="color: var(--primary);"></i> Diseñado con amor y cuidado
            </p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales
            let presupuestoActual = {
                mes: new Date().getMonth() + 1,
                año: new Date().getFullYear(),
                ingresos: {},
                gastos: {},
                extras: []
            };
           
            // Referencias a elementos de ingresos
            const ingresosInputs = {
                sueldo: { estimado: 'estimado-sueldo', real: 'real-sueldo', fecha: 'fecha-sueldo' },
                extra: { estimado: 'estimado-extra', real: 'real-extra', fecha: 'fecha-extra' },
                inversiones: { estimado: 'estimado-inversiones', real: 'real-inversiones', fecha: 'fecha-inversiones' }
            };
           
            // Referencias a elementos de gastos
            const gastosInputs = {
                luz: { estimado: 'estimado-luz', real: 'real-luz', fecha: 'fecha-luz' },
                agua: { estimado: 'estimado-agua', real: 'real-agua', fecha: 'fecha-agua' },
                internet: { estimado: 'estimado-internet', real: 'real-internet', fecha: 'fecha-internet' },
                alimentacion: { estimado: 'estimado-alimentacion', real: 'real-alimentacion', fecha: 'fecha-alimentacion' },
                ahorro: { estimado: 'estimado-ahorro', real: 'real-ahorro', fecha: 'fecha-ahorro' },
                otros: { estimado: 'estimado-otros', real: 'real-otros', fecha: 'fecha-otros' }
            };
           
            // Elementos de totales
            const totalIngresosEstimado = document.getElementById('total-ingresos-estimado');
            const totalIngresosReal = document.getElementById('total-ingresos-real');
            const totalGastosEstimado = document.getElementById('total-gastos-estimado');
            const totalGastosReal = document.getElementById('total-gastos-real');
            const saldoEstimado = document.getElementById('saldo-estimado');
            const saldoReal = document.getElementById('saldo-real');
           
            // Elementos de resumen
            const resumenIngresos = document.getElementById('resumen-ingresos');
            const resumenGastos = document.getElementById('resumen-gastos');
            const resumenSaldo = document.getElementById('resumen-saldo');
           
            // Selectores de mes y año
            const selectMonth = document.getElementById('select-month');
            const selectYear = document.getElementById('select-year');
           
            // Inicializar con el mes actual
            selectMonth.value = presupuestoActual.mes;
            selectYear.value = presupuestoActual.año;
           
            // Cargar datos del mes actual al iniciar
            cargarPresupuestoMes();
           
            // FUNCIONES PRINCIPALES
           
            // Calcular y actualizar todos los totales
            function calcularTotales() {
                let totalEstimadoIngresos = 0;
                let totalRealIngresos = 0;
                let totalEstimadoGastos = 0;
                let totalRealGastos = 0;
               
                // Calcular ingresos
                for (let key in ingresosInputs) {
                    const estimado = parseFloat(document.getElementById(ingresosInputs[key].estimado).value) || 0;
                    const real = parseFloat(document.getElementById(ingresosInputs[key].real).value) || 0;
                   
                    totalEstimadoIngresos += estimado;
                    totalRealIngresos += real;
                   
                    // Guardar en objeto presupuestoActual
                    presupuestoActual.ingresos[key] = {
                        estimado: estimado,
                        real: real,
                        fecha: document.getElementById(ingresosInputs[key].fecha).value
                    };
                }
               
                // Calcular gastos fijos
                for (let key in gastosInputs) {
                    const estimado = parseFloat(document.getElementById(gastosInputs[key].estimado).value) || 0;
                    const real = parseFloat(document.getElementById(gastosInputs[key].real).value) || 0;
                   
                    totalEstimadoGastos += estimado;
                    totalRealGastos += real;
                   
                    // Guardar en objeto presupuestoActual
                    presupuestoActual.gastos[key] = {
                        estimado: estimado,
                        real: real,
                        fecha: document.getElementById(gastosInputs[key].fecha).value
                    };
                }
               
                // Sumar gastos extras
                presupuestoActual.extras.forEach(gasto => {
                    totalRealGastos += gasto.monto;
                });
               
                // Calcular saldos
                const saldoEstimadoCalc = totalEstimadoIngresos - totalEstimadoGastos;
                const saldoRealCalc = totalRealIngresos - totalRealGastos;
               
                // Actualizar tabla de totales con animación
                actualizarConAnimacion(totalIngresosEstimado, totalEstimadoIngresos);
                actualizarConAnimacion(totalIngresosReal, totalRealIngresos);
                actualizarConAnimacion(totalGastosEstimado, totalEstimadoGastos);
                actualizarConAnimacion(totalGastosReal, totalRealGastos);
                actualizarConAnimacion(saldoEstimado, saldoEstimadoCalc);
                actualizarConAnimacion(saldoReal, saldoRealCalc);
               
                // Actualizar resumen con animación
                actualizarConAnimacion(resumenIngresos, totalRealIngresos);
                actualizarConAnimacion(resumenGastos, totalRealGastos);
                actualizarConAnimacion(resumenSaldo, saldoRealCalc);
               
                // Cambiar color del saldo según sea positivo o negativo
                if (saldoRealCalc < 0) {
                    resumenSaldo.classList.add('saldo-negativo');
                    saldoReal.classList.add('saldo-negativo');
                } else {
                    resumenSaldo.classList.remove('saldo-negativo');
                    saldoReal.classList.remove('saldo-negativo');
                }
            }
           
            // Función para actualizar con animación
            function actualizarConAnimacion(elemento, valor) {
                elemento.classList.add('cambio-destacado');
                elemento.textContent = `$${valor.toFixed(2)}`;
                
                // Remover la clase de animación después de que termine
                setTimeout(() => {
                    elemento.classList.remove('cambio-destacado');
                }, 500);
            }
           
            // Guardar presupuesto en localStorage
            function guardarPresupuesto() {
                calcularTotales(); // Asegurar que los datos están actualizados
               
                const clave = `presupuesto_${presupuestoActual.año}_${presupuestoActual.mes}`;
                localStorage.setItem(clave, JSON.stringify(presupuestoActual));
               
                // Mostrar mensaje bonito
                mostrarNotificacion(`Presupuesto de ${getNombreMes(presupuestoActual.mes)} ${presupuestoActual.año} guardado correctamente.`, 'success');
               
                // También guardar en lista de meses disponibles
                guardarMesDisponible(presupuestoActual.mes, presupuestoActual.año);
            }
           
            // Cargar presupuesto desde localStorage
            function cargarPresupuestoMes() {
                const mes = parseInt(selectMonth.value);
                const año = parseInt(selectYear.value);
               
                presupuestoActual.mes = mes;
                presupuestoActual.año = año;
               
                const clave = `presupuesto_${año}_${mes}`;
                const datosGuardados = localStorage.getItem(clave);
               
                if (datosGuardados) {
                    presupuestoActual = JSON.parse(datosGuardados);
                   
                    // Cargar ingresos
                    for (let key in ingresosInputs) {
                        if (presupuestoActual.ingresos[key]) {
                            document.getElementById(ingresosInputs[key].estimado).value = presupuestoActual.ingresos[key].estimado || '';
                            document.getElementById(ingresosInputs[key].real).value = presupuestoActual.ingresos[key].real || '';
                            document.getElementById(ingresosInputs[key].fecha).value = presupuestoActual.ingresos[key].fecha || '';
                        }
                    }
                   
                    // Cargar gastos
                    for (let key in gastosInputs) {
                        if (presupuestoActual.gastos[key]) {
                            document.getElementById(gastosInputs[key].estimado).value = presupuestoActual.gastos[key].estimado || '';
                            document.getElementById(gastosInputs[key].real).value = presupuestoActual.gastos[key].real || '';
                            document.getElementById(gastosInputs[key].fecha).value = presupuestoActual.gastos[key].fecha || '';
                        }
                    }
                   
                    // Cargar gastos extras
                    cargarGastosExtras();
                   
                    mostrarNotificacion(`Presupuesto de ${getNombreMes(mes)} ${año} cargado.`, 'info');
                } else {
                    // Limpiar todos los campos si no hay datos guardados
                    limpiarCampos();
                    presupuestoActual.extras = [];
                    cargarGastosExtras();
                    mostrarNotificacion(`Nuevo presupuesto para ${getNombreMes(mes)} ${año}.`, 'info');
                }
               
                calcularTotales();
            }
           
            // Limpiar todos los campos
            function limpiarCampos() {
                // Limpiar ingresos
                for (let key in ingresosInputs) {
                    document.getElementById(ingresosInputs[key].estimado).value = '';
                    document.getElementById(ingresosInputs[key].real).value = '';
                    document.getElementById(ingresosInputs[key].fecha).value = '';
                }
               
                // Limpiar gastos
                for (let key in gastosInputs) {
                    document.getElementById(gastosInputs[key].estimado).value = '';
                    document.getElementById(gastosInputs[key].real).value = '';
                    document.getElementById(gastosInputs[key].fecha).value = '';
                }
               
                // Limpiar extras
                presupuestoActual.extras = [];
                cargarGastosExtras();
               
                // Establecer fechas por defecto (fecha actual)
                const hoy = new Date().toISOString().split('T')[0];
                document.querySelectorAll('input[type="date"]').forEach(input => {
                    if (!input.value) input.value = hoy;
                });
            }
           
            // Guardar mes en lista de meses disponibles
            function guardarMesDisponible(mes, año) {
                let mesesDisponibles = JSON.parse(localStorage.getItem('meses_disponibles')) || [];
               
                const mesKey = `${año}-${mes}`;
               
                if (!mesesDisponibles.includes(mesKey)) {
                    mesesDisponibles.push(mesKey);
                    localStorage.setItem('meses_disponibles', JSON.stringify(mesesDisponibles));
                }
            }
           
            // Obtener nombre del mes
            function getNombreMes(numeroMes) {
                const meses = [
                    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                ];
                return meses[numeroMes - 1] || 'Desconocido';
            }
           
            // Funciones para gastos extras
            function cargarGastosExtras() {
                const lista = document.getElementById('lista-gastos-extras');
                lista.innerHTML = '';
               
                if (presupuestoActual.extras.length === 0) {
                    lista.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No hay gastos extras registrados.</p>';
                    return;
                }
               
                const tabla = document.createElement('table');
                tabla.className = 'budget-table';
                tabla.innerHTML = `
                    <thead>
                        <tr>
                            <th>Descripción</th>
                            <th style="width: 150px;">Monto</th>
                            <th style="width: 100px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="body-gastos-extras"></tbody>
                `;
               
                lista.appendChild(tabla);
                const tbody = document.getElementById('body-gastos-extras');
               
                presupuestoActual.extras.forEach((gasto, index) => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${gasto.descripcion}</td>
                        <td>$${gasto.monto.toFixed(2)}</td>
                        <td>
                            <button onclick="eliminarGastoExtra(${index})" style="background: var(--expense-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; transition: all 0.3s;">
                                <i class="fas fa-trash-alt"></i> Eliminar
                            </button>
                        </td>
                    `;
                    tbody.appendChild(fila);
                });
            }
           
            // Función global para eliminar gasto extra
            window.eliminarGastoExtra = function(index) {
                if (confirm('¿Estás seguro de que quieres eliminar este gasto extra?')) {
                    presupuestoActual.extras.splice(index, 1);
                    cargarGastosExtras();
                    calcularTotales();
                    guardarPresupuesto();
                }
            };
           
            // Agregar nuevo gasto extra
            function agregarGastoExtra() {
                const descInput = document.getElementById('nuevo-gasto-desc');
                const montoInput = document.getElementById('nuevo-gasto-monto');
               
                const descripcion = descInput.value.trim();
                const monto = parseFloat(montoInput.value);
               
                if (!descripcion) {
                    mostrarNotificacion('Por favor, ingresa una descripción para el gasto.', 'error');
                    descInput.focus();
                    return;
                }
               
                if (!monto || monto <= 0) {
                    mostrarNotificacion('Por favor, ingresa un monto válido mayor a cero.', 'error');
                    montoInput.focus();
                    return;
                }
               
                presupuestoActual.extras.push({
                    descripcion: descripcion,
                    monto: monto,
                    fecha: new Date().toISOString().split('T')[0]
                });
               
                // Limpiar inputs
                descInput.value = '';
                montoInput.value = '';
               
                // Actualizar interfaz
                cargarGastosExtras();
                calcularTotales();
               
                // Mostrar sección de gastos extras si estaba oculta
                document.getElementById('gastos-extras-section').style.display = 'block';
               
                mostrarNotificacion('Gasto extra agregado correctamente.', 'success');
            }
           
            // Mostrar notificación bonita
            function mostrarNotificacion(mensaje, tipo) {
                // Crear elemento de notificación
                const notificacion = document.createElement('div');
                notificacion.textContent = mensaje;
                notificacion.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    border-radius: 8px;
                    color: white;
                    font-weight: bold;
                    z-index: 1000;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    animation: slideIn 0.3s ease;
                `;
               
                // Estilo según tipo
                if (tipo === 'success') {
                    notificacion.style.backgroundColor = 'var(--income-color)';
                } else if (tipo === 'error') {
                    notificacion.style.backgroundColor = 'var(--expense-color)';
                } else {
                    notificacion.style.backgroundColor = 'var(--primary)';
                }
               
                document.body.appendChild(notificacion);
               
                // Remover después de 3 segundos
                setTimeout(() => {
                    notificacion.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notificacion);
                    }, 300);
                }, 3000);
            }
           
            // Animaciones CSS para notificaciones
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
           
            // EVENT LISTENERS
           
            // Calcular automáticamente cuando cambia cualquier campo
            document.querySelectorAll('input[type="number"], input[type="date"]').forEach(input => {
                input.addEventListener('input', calcularTotales);
                input.addEventListener('change', calcularTotales);
            });
           
            // Selectores de mes y año
            selectMonth.addEventListener('change', cargarPresupuestoMes);
            selectYear.addEventListener('change', cargarPresupuestoMes);
           
            // Botón guardar
            document.getElementById('btn-guardar').addEventListener('click', guardarPresupuesto);
           
            // Botón cargar
            document.getElementById('btn-cargar').addEventListener('click', function() {
                cargarPresupuestoMes();
            });
           
            // Botón limpiar
            document.getElementById('btn-limpiar').addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres limpiar todos los campos? Se perderán los cambios no guardados.')) {
                    limpiarCampos();
                    calcularTotales();
                }
            });
           
            // Botón agregar gasto extra
            document.getElementById('btn-agregar-gasto').addEventListener('click', function() {
                const seccion = document.getElementById('gastos-extras-section');
                seccion.style.display = seccion.style.display === 'none' ? 'block' : 'none';
            });
           
            // Botón agregar gasto a la lista
            document.getElementById('btn-agregar-gasto-lista').addEventListener('click', agregarGastoExtra);
           
            // Permitir agregar gasto con Enter
            document.getElementById('nuevo-gasto-desc').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') agregarGastoExtra();
            });
           
            document.getElementById('nuevo-gasto-monto').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') agregarGastoExtra();
            });
           
            // Establecer fechas por defecto al cargar
            window.addEventListener('load', function() {
                const hoy = new Date().toISOString().split('T')[0];
                document.querySelectorAll('input[type="date"]').forEach(input => {
                    if (!input.value) input.value = hoy;
                });
               
                calcularTotales();
            });
        });
    </script>
</body>
</html>
