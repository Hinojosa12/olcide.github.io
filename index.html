<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Presupuesto Mensual</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Paleta de colores rosa pastel */
            --rosa-pastel-claro: #fff0f5;
            --rosa-pastel-medio: #ffd6e7;
            --rosa-pastel-fuerte: #ffc2d6;
            --rosa-pastel-oscuro: #ff8fab;
            
            /* Colores funcionales */
            --primary: #ff6b9d;
            --secondary: #d81b60;
            --income-color: #2e8b57;
            --expense-color: #c71585;
            --text-primary: #5a3d5c;
            --text-secondary: #7a5c7c;
            --border-color: #ffb6c1;
            --table-header: #ffe4ec;
            --header-color: #9d4b6e;
        }
       
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
       
        html {
            font-size: 16px;
            height: 100%;
        }
       
        body {
            background-color: var(--rosa-pastel-claro);
            color: var(--text-primary);
            padding: 0;
            margin: 0;
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }
       
        .container {
            width: 100%;
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
        }
       
        header {
            background: linear-gradient(135deg, var(--rosa-pastel-fuerte), var(--rosa-pastel-oscuro));
            color: white;
            padding: 20px 15px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.15);
        }
       
        h1 {
            font-size: 1.6rem;
            margin-bottom: 8px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            font-weight: 700;
        }
       
        h2 {
            font-size: 1.3rem;
            margin: 20px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--rosa-pastel-fuerte);
            color: var(--header-color);
            font-weight: 600;
        }
       
        /* ESTILOS CURSIVOS PARA T√çTULOS ESPEC√çFICOS */
        .titulo-cursivo {
            font-style: italic !important;
            font-weight: 600;
        }
       
        .budget-section {
            background: var(--rosa-pastel-medio);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            box-shadow: 0 3px 8px rgba(255, 182, 193, 0.2);
            border: 1px solid var(--rosa-pastel-fuerte);
            overflow: hidden;
        }
       
        /* ESTILOS DE TABLA OPTIMIZADOS PARA M√ìVIL */
        .budget-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.95rem;
            background-color: var(--rosa-pastel-medio);
            border-radius: 8px;
            overflow: hidden;
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
       
        .budget-table thead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
       
        .budget-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
       
        .budget-table th {
            background-color: var(--table-header);
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 0.9rem;
            white-space: nowrap;
        }
       
        .budget-table td {
            padding: 10px 8px;
            border: 1px solid var(--border-color);
            background-color: rgba(255, 255, 255, 0.7);
            word-break: break-word;
            min-height: 44px;
            vertical-align: middle;
        }
       
        /* Columnas optimizadas para m√≥vil */
        .budget-table th:nth-child(1),
        .budget-table td:nth-child(1) {
            width: 28%;
            min-width: 90px;
        }
       
        .budget-table th:nth-child(2),
        .budget-table td:nth-child(2) {
            width: 32%;
            min-width: 110px;
        }
       
        .budget-table th:nth-child(3),
        .budget-table td:nth-child(3) {
            width: 20%;
            min-width: 85px;
        }
       
        .budget-table th:nth-child(4),
        .budget-table td:nth-child(4) {
            width: 20%;
            min-width: 85px;
        }
       
        .budget-table input {
            width: 100%;
            padding: 10px 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            background-color: white;
            transition: all 0.2s;
            min-height: 44px;
            -webkit-appearance: none;
            appearance: none;
        }
       
        .budget-table input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
            background-color: white;
        }
       
        .budget-table input[type="date"] {
            cursor: pointer;
            font-size: 0.95rem;
        }
       
        .budget-table input[type="number"] {
            text-align: right;
        }
       
        /* Mejorar usabilidad de inputs en iOS */
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0.7;
            padding: 5px;
        }
       
        input[type="number"]::-webkit-inner-spin-button {
            opacity: 1;
            height: 40px;
        }
       
        .subtotal {
            font-weight: 600;
            background-color: rgba(255, 228, 236, 0.8) !important;
        }
       
        .total-row {
            font-weight: 700;
            font-size: 1.05rem;
            background-color: var(--table-header) !important;
        }
       
        /* Secci√≥n de resumen optimizada para m√≥vil */
        .summary {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }
       
        .summary-item {
            background: var(--rosa-pastel-medio);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(255, 182, 193, 0.2);
            border: 1px solid var(--rosa-pastel-fuerte);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
       
        .summary-item:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(255, 182, 193, 0.3);
        }
       
        .summary-item h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-weight: 600;
        }
       
        .summary-amount {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
            line-height: 1.2;
        }
       
        .income-amount {
            color: var(--income-color);
        }
       
        .expense-amount {
            color: var(--expense-color);
        }
       
        .balance-amount {
            color: var(--primary);
        }
       
        /* Controles de acci√≥n optimizados para m√≥vil */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
       
        .control-btn {
            background: linear-gradient(to right, var(--primary), var(--rosa-pastel-oscuro));
            color: white;
            border: none;
            padding: 16px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 8px rgba(255, 107, 157, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 56px;
            width: 100%;
            touch-action: manipulation;
        }
       
        .control-btn:active {
            background: linear-gradient(to right, var(--secondary), var(--primary));
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);
        }
       
        .control-btn i {
            font-size: 1.2rem;
        }
       
        .control-btn.secondary {
            background: linear-gradient(to right, #ff8fab, #ff6b9d);
        }
       
        .control-btn.secondary:active {
            background: linear-gradient(to right, #ff6b9d, #d81b60);
        }
       
        /* Selector de mes optimizado para m√≥vil */
        .month-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            background-color: var(--rosa-pastel-medio);
            padding: 18px;
            border-radius: 12px;
            border: 1px solid var(--rosa-pastel-fuerte);
        }
       
        .month-selector-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
       
        .month-selector label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }
       
        .month-selector select {
            padding: 14px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            font-size: 1rem;
            color: var(--text-primary);
            cursor: pointer;
            min-height: 52px;
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235a3d5c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
            padding-right: 45px;
        }
       
        footer {
            text-align: center;
            padding: 20px 15px;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 2px solid var(--rosa-pastel-fuerte);
            background-color: var(--rosa-pastel-medio);
            border-radius: 12px;
            line-height: 1.4;
        }
       
        /* Gastos extras optimizado para m√≥vil */
        #gastos-extras-section {
            background-color: var(--rosa-pastel-medio);
            border-radius: 12px;
            padding: 18px;
            margin-top: 20px;
            border: 1px solid var(--rosa-pastel-fuerte);
        }
       
        #lista-gastos-extras {
            margin-bottom: 20px;
            overflow-x: auto;
        }
       
        .gasto-extra-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
       
        #nuevo-gasto-desc, #nuevo-gasto-monto {
            padding: 14px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            color: var(--text-primary);
            font-size: 1rem;
            min-height: 52px;
            width: 100%;
        }
       
        /* Bot√≥n para agregar gastos extras */
        #btn-agregar-gasto-lista {
            margin-top: 10px;
            padding: 16px;
        }
       
        /* Eliminar bot√≥n de gastos extras */
        .btn-eliminar-gasto {
            background: var(--expense-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            min-height: 44px;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }
       
        .btn-eliminar-gasto:active {
            opacity: 0.8;
            transform: translateY(1px);
        }
       
        /* Animaci√≥n para cambios en n√∫meros */
        @keyframes cambioNumero {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
       
        .cambio-destacado {
            animation: cambioNumero 0.3s ease;
        }
       
        /* Estilos para el saldo negativo */
        .saldo-negativo {
            color: var(--expense-color) !important;
            font-weight: 700;
        }
       
        /* Decoraci√≥n floral para m√≥vil */
        .floral-decoration {
            position: fixed;
            z-index: -1;
            opacity: 0.08;
            font-size: 120px;
            color: var(--primary);
            pointer-events: none;
        }
       
        .floral-1 {
            top: 5%;
            left: 5%;
            transform: rotate(-15deg);
        }
       
        .floral-2 {
            bottom: 5%;
            right: 5%;
            transform: rotate(15deg);
        }
       
        /* Notificaciones para m√≥vil */
        .notificacion {
            position: fixed;
            top: 20px;
            left: 15px;
            right: 15px;
            padding: 18px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            animation: slideInMobile 0.3s ease;
            text-align: center;
            font-size: 0.95rem;
            backdrop-filter: blur(10px);
        }
       
        /* Safe areas para iPhone X+ */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
                padding-top: max(15px, env(safe-area-inset-top));
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
           
            .control-btn, select, input {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
            }
        }
       
        /* Animaciones para m√≥vil */
        @keyframes slideInMobile {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
       
        @keyframes slideOutMobile {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-100%); opacity: 0; }
        }
       
        /* MEDIA QUERIES para tablet y desktop */
        @media (min-width: 768px) {
            .container {
                max-width: 700px;
                padding: 25px;
            }
           
            h1 {
                font-size: 2rem;
            }
           
            h2 {
                font-size: 1.5rem;
            }
           
            .summary {
                flex-direction: row;
                flex-wrap: wrap;
            }
           
            .summary-item {
                flex: 1;
                min-width: 200px;
            }
           
            .controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
           
            .control-btn {
                flex: 1;
                min-width: 200px;
            }
           
            .month-selector {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
           
            .month-selector-group {
                flex-direction: row;
                align-items: center;
                gap: 15px;
                flex: 1;
            }
           
            .month-selector select {
                flex: 1;
            }
           
            .floral-decoration {
                font-size: 200px;
            }
           
            .notificacion {
                left: auto;
                right: 20px;
                width: auto;
                max-width: 400px;
            }
           
            @keyframes slideInMobile {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
           
            @keyframes slideOutMobile {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        }
       
        /* Mejoras para pantallas muy peque√±as */
        @media (max-width: 360px) {
            html {
                font-size: 14px;
            }
           
            .budget-table {
                font-size: 0.85rem;
            }
           
            .budget-table th,
            .budget-table td {
                padding: 8px 6px;
            }
           
            .budget-table input {
                padding: 8px 6px;
                font-size: 0.9rem;
            }
           
            .budget-table th:nth-child(1),
            .budget-table td:nth-child(1) {
                min-width: 80px;
            }
        }
       
        /* Prevenir zoom en inputs en iOS */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
           
            input[type="date"] {
                font-size: 16px !important;
            }
        }
       
        /* Mejorar scroll en iOS */
        .budget-table {
            -webkit-overflow-scrolling: touch;
        }
       
        /* Estado de carga */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
       
        /* Placeholder styles */
        ::placeholder {
            color: #a88fa3;
            opacity: 0.7;
        }
       
        /* Focus styles para accesibilidad */
        *:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Decoraciones florales de fondo -->
    <div class="floral-decoration floral-1">
        <i class="fas fa-heart"></i>
    </div>
    <div class="floral-decoration floral-2">
        <i class="fas fa-heart"></i>
    </div>
    
    <div class="container">
        <header>
            <h1>Presupuesto Mensual</h1>
            <p>Controla tus ingresos y gastos con estilo</p>
        </header>
       
        <div class="month-selector">
            <div class="month-selector-group">
                <label for="select-month">Mes:</label>
                <select id="select-month">
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
            </div>
            <div class="month-selector-group">
                <label for="select-year">A√±o:</label>
                <select id="select-year">
                    <option value="2024">2024</option>
                    <option value="2025" selected>2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>
        </div>
       
        <!-- SECCI√ìN DE INGRESOS -->
        <div class="budget-section">
            <h2 class="titulo-cursivo">(+) <i>Ingresos</i>:</h2>
            <table class="budget-table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Descripci√≥n</th>
                        <th>Estimado</th>
                        <th>Real</th>
                    </tr>
                </thead>
                <tbody id="ingresos-body">
                    <!-- Sueldo -->
                    <tr>
                        <td><input type="date" id="fecha-sueldo"></td>
                        <td>Sueldo</td>
                        <td><input type="number" id="estimado-sueldo" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-sueldo" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Trabajo extra -->
                    <tr>
                        <td><input type="date" id="fecha-extra"></td>
                        <td>Trabajo extra</td>
                        <td><input type="number" id="estimado-extra" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-extra" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Inversiones -->
                    <tr>
                        <td><input type="date" id="fecha-inversiones"></td>
                        <td>Inversiones</td>
                        <td><input type="number" id="estimado-inversiones" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-inversiones" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Suma de ingresos -->
                    <tr class="subtotal">
                        <td colspan="2" style="text-align: right; font-style: italic;">Suma de <i>ingresos</i>:</td>
                        <td id="total-ingresos-estimado">$0.00</td>
                        <td id="total-ingresos-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- SECCI√ìN DE GASTOS -->
        <div class="budget-section">
            <h2 class="titulo-cursivo">(-) <i>Gastos</i>:</h2>
            <table class="budget-table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Descripci√≥n</th>
                        <th>Estimado</th>
                        <th>Real</th>
                    </tr>
                </thead>
                <tbody id="gastos-body">
                    <!-- Servicios b√°sicos -->
                    <tr>
                        <td><input type="date" id="fecha-luz"></td>
                        <td>Servicio de luz</td>
                        <td><input type="number" id="estimado-luz" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-luz" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <tr>
                        <td><input type="date" id="fecha-agua"></td>
                        <td>Servicio de agua</td>
                        <td><input type="number" id="estimado-agua" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-agua" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <tr>
                        <td><input type="date" id="fecha-internet"></td>
                        <td>Internet y telefon√≠a</td>
                        <td><input type="number" id="estimado-internet" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-internet" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Alimentaci√≥n -->
                    <tr>
                        <td><input type="date" id="fecha-alimentacion"></td>
                        <td>Alimentaci√≥n</td>
                        <td><input type="number" id="estimado-alimentacion" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-alimentacion" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Ahorro -->
                    <tr>
                        <td><input type="date" id="fecha-ahorro"></td>
                        <td>Ahorro</td>
                        <td><input type="number" id="estimado-ahorro" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-ahorro" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Otros -->
                    <tr>
                        <td><input type="date" id="fecha-otros"></td>
                        <td>Otros</td>
                        <td><input type="number" id="estimado-otros" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                        <td><input type="number" id="real-otros" placeholder="0.00" step="0.01" inputmode="decimal"></td>
                    </tr>
                    <!-- Suma de gastos -->
                    <tr class="subtotal">
                        <td colspan="2" style="text-align: right; font-style: italic;">Suma de <i>gastos</i>:</td>
                        <td id="total-gastos-estimado">$0.00</td>
                        <td id="total-gastos-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- SECCI√ìN DE SALDO NETO -->
        <div class="budget-section">
            <h2>(-) Saldo Neto:</h2>
            <table class="budget-table">
                <tbody>
                    <tr class="total-row">
                        <td colspan="2" style="text-align: right;">Saldo Neto del Mes:</td>
                        <td id="saldo-estimado">$0.00</td>
                        <td id="saldo-real">$0.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
       
        <!-- RESUMEN R√ÅPIDO -->
        <div class="summary">
            <div class="summary-item">
                <h3><i>Ingresos</i> Totales</h3>
                <div class="summary-amount income-amount" id="resumen-ingresos">$0.00</div>
                <p>Este mes</p>
            </div>
            <div class="summary-item">
                <h3><i>Gastos</i> Totales</h3>
                <div class="summary-amount expense-amount" id="resumen-gastos">$0.00</div>
                <p>Este mes</p>
            </div>
            <div class="summary-item">
                <h3>Saldo Final</h3>
                <div class="summary-amount balance-amount" id="resumen-saldo">$0.00</div>
                <p>Disponible</p>
            </div>
        </div>
       
        <!-- CONTROLES -->
        <div class="controls">
            <button class="control-btn" id="btn-guardar">
                <i class="fas fa-save"></i> Guardar Presupuesto
            </button>
            <button class="control-btn secondary" id="btn-cargar">
                <i class="fas fa-folder-open"></i> Cargar Mes
            </button>
            <button class="control-btn secondary" id="btn-limpiar">
                <i class="fas fa-broom"></i> Limpiar Todo
            </button>
            <button class="control-btn secondary" id="btn-agregar-gasto">
                <i class="fas fa-plus-circle"></i> Agregar Gasto
            </button>
        </div>
       
        <!-- LISTA DE GASTOS EXTRAS -->
        <div class="budget-section" id="gastos-extras-section" style="display: none;">
            <h2><i>Gastos</i> Extras:</h2>
            <div id="lista-gastos-extras">
                <!-- Los gastos extras se agregar√°n aqu√≠ din√°micamente -->
            </div>
            <div class="gasto-extra-form">
                <input type="text" id="nuevo-gasto-desc" placeholder="Descripci√≥n del gasto">
                <input type="number" id="nuevo-gasto-monto" placeholder="Monto" step="0.01" inputmode="decimal">
                <button class="control-btn" id="btn-agregar-gasto-lista">
                    <i class="fas fa-plus"></i> Agregar Gasto Extra
                </button>
            </div>
        </div>
       
        <footer>
            <p>Presupuesto Mensual &copy; 2026</p>
            <p style="margin-top: 8px; font-size: 0.8rem; color: var(--rosa-pastel-oscuro);">
                <i class="fas fa-heart" style="color: var(--primary);"></i> Dise√±ado para m√≥vil
            </p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales
            let presupuestoActual = {
                mes: new Date().getMonth() + 1,
                a√±o: new Date().getFullYear(),
                ingresos: {},
                gastos: {},
                extras: []
            };
           
            // Referencias a elementos de ingresos
            const ingresosInputs = {
                sueldo: { estimado: 'estimado-sueldo', real: 'real-sueldo', fecha: 'fecha-sueldo' },
                extra: { estimado: 'estimado-extra', real: 'real-extra', fecha: 'fecha-extra' },
                inversiones: { estimado: 'estimado-inversiones', real: 'real-inversiones', fecha: 'fecha-inversiones' }
            };
           
            // Referencias a elementos de gastos
            const gastosInputs = {
                luz: { estimado: 'estimado-luz', real: 'real-luz', fecha: 'fecha-luz' },
                agua: { estimado: 'estimado-agua', real: 'real-agua', fecha: 'fecha-agua' },
                internet: { estimado: 'estimado-internet', real: 'real-internet', fecha: 'fecha-internet' },
                alimentacion: { estimado: 'estimado-alimentacion', real: 'real-alimentacion', fecha: 'fecha-alimentacion' },
                ahorro: { estimado: 'estimado-ahorro', real: 'real-ahorro', fecha: 'fecha-ahorro' },
                otros: { estimado: 'estimado-otros', real: 'real-otros', fecha: 'fecha-otros' }
            };
           
            // Elementos de totales
            const totalIngresosEstimado = document.getElementById('total-ingresos-estimado');
            const totalIngresosReal = document.getElementById('total-ingresos-real');
            const totalGastosEstimado = document.getElementById('total-gastos-estimado');
            const totalGastosReal = document.getElementById('total-gastos-real');
            const saldoEstimado = document.getElementById('saldo-estimado');
            const saldoReal = document.getElementById('saldo-real');
           
            // Elementos de resumen
            const resumenIngresos = document.getElementById('resumen-ingresos');
            const resumenGastos = document.getElementById('resumen-gastos');
            const resumenSaldo = document.getElementById('resumen-saldo');
           
            // Selectores de mes y a√±o
            const selectMonth = document.getElementById('select-month');
            const selectYear = document.getElementById('select-year');
           
            // Inicializar con el mes actual
            const hoy = new Date();
            selectMonth.value = hoy.getMonth() + 1;
            selectYear.value = hoy.getFullYear();
            presupuestoActual.mes = hoy.getMonth() + 1;
            presupuestoActual.a√±o = hoy.getFullYear();
           
            // Cargar datos del mes actual al iniciar
            cargarPresupuestoMes();
           
            // FUNCIONES PRINCIPALES
           
            // Calcular y actualizar todos los totales
            function calcularTotales() {
                let totalEstimadoIngresos = 0;
                let totalRealIngresos = 0;
                let totalEstimadoGastos = 0;
                let totalRealGastos = 0;
               
                // Calcular ingresos
                for (let key in ingresosInputs) {
                    const estimado = parseFloat(document.getElementById(ingresosInputs[key].estimado).value) || 0;
                    const real = parseFloat(document.getElementById(ingresosInputs[key].real).value) || 0;
                   
                    totalEstimadoIngresos += estimado;
                    totalRealIngresos += real;
                   
                    // Guardar en objeto presupuestoActual
                    presupuestoActual.ingresos[key] = {
                        estimado: estimado,
                        real: real,
                        fecha: document.getElementById(ingresosInputs[key].fecha).value
                    };
                }
               
                // Calcular gastos fijos
                for (let key in gastosInputs) {
                    const estimado = parseFloat(document.getElementById(gastosInputs[key].estimado).value) || 0;
                    const real = parseFloat(document.getElementById(gastosInputs[key].real).value) || 0;
                   
                    totalEstimadoGastos += estimado;
                    totalRealGastos += real;
                   
                    // Guardar en objeto presupuestoActual
                    presupuestoActual.gastos[key] = {
                        estimado: estimado,
                        real: real,
                        fecha: document.getElementById(gastosInputs[key].fecha).value
                    };
                }
               
                // Sumar gastos extras
                presupuestoActual.extras.forEach(gasto => {
                    totalRealGastos += gasto.monto;
                });
               
                // Calcular saldos
                const saldoEstimadoCalc = totalEstimadoIngresos - totalEstimadoGastos;
                const saldoRealCalc = totalRealIngresos - totalRealGastos;
               
                // Actualizar tabla de totales con animaci√≥n
                actualizarConAnimacion(totalIngresosEstimado, totalEstimadoIngresos);
                actualizarConAnimacion(totalIngresosReal, totalRealIngresos);
                actualizarConAnimacion(totalGastosEstimado, totalEstimadoGastos);
                actualizarConAnimacion(totalGastosReal, totalRealGastos);
                actualizarConAnimacion(saldoEstimado, saldoEstimadoCalc);
                actualizarConAnimacion(saldoReal, saldoRealCalc);
               
                // Actualizar resumen con animaci√≥n
                actualizarConAnimacion(resumenIngresos, totalRealIngresos);
                actualizarConAnimacion(resumenGastos, totalRealGastos);
                actualizarConAnimacion(resumenSaldo, saldoRealCalc);
               
                // Cambiar color del saldo seg√∫n sea positivo o negativo
                if (saldoRealCalc < 0) {
                    resumenSaldo.classList.add('saldo-negativo');
                    saldoReal.classList.add('saldo-negativo');
                } else {
                    resumenSaldo.classList.remove('saldo-negativo');
                    saldoReal.classList.remove('saldo-negativo');
                }
            }
           
            // Funci√≥n para actualizar con animaci√≥n
            function actualizarConAnimacion(elemento, valor) {
                elemento.classList.add('cambio-destacado');
                elemento.textContent = `$${valor.toFixed(2)}`;
                
                // Remover la clase de animaci√≥n despu√©s de que termine
                setTimeout(() => {
                    elemento.classList.remove('cambio-destacado');
                }, 300);
            }
           
            // Guardar presupuesto en localStorage
            function guardarPresupuesto() {
                mostrarCarga(true);
                calcularTotales(); // Asegurar que los datos est√°n actualizados
               
                const clave = `presupuesto_${presupuestoActual.a√±o}_${presupuestoActual.mes}`;
                localStorage.setItem(clave, JSON.stringify(presupuestoActual));
               
                // Tambi√©n guardar en lista de meses disponibles
                guardarMesDisponible(presupuestoActual.mes, presupuestoActual.a√±o);
               
                setTimeout(() => {
                    mostrarNotificacion(`‚úÖ Presupuesto de ${getNombreMes(presupuestoActual.mes)} guardado`, 'success');
                    mostrarCarga(false);
                }, 300);
            }
           
            // Cargar presupuesto desde localStorage
            function cargarPresupuestoMes() {
                mostrarCarga(true);
               
                const mes = parseInt(selectMonth.value);
                const a√±o = parseInt(selectYear.value);
               
                presupuestoActual.mes = mes;
                presupuestoActual.a√±o = a√±o;
               
                const clave = `presupuesto_${a√±o}_${mes}`;
                const datosGuardados = localStorage.getItem(clave);
               
                setTimeout(() => {
                    if (datosGuardados) {
                        presupuestoActual = JSON.parse(datosGuardados);
                       
                        // Cargar ingresos
                        for (let key in ingresosInputs) {
                            if (presupuestoActual.ingresos[key]) {
                                document.getElementById(ingresosInputs[key].estimado).value = presupuestoActual.ingresos[key].estimado || '';
                                document.getElementById(ingresosInputs[key].real).value = presupuestoActual.ingresos[key].real || '';
                                document.getElementById(ingresosInputs[key].fecha).value = presupuestoActual.ingresos[key].fecha || '';
                            }
                        }
                       
                        // Cargar gastos
                        for (let key in gastosInputs) {
                            if (presupuestoActual.gastos[key]) {
                                document.getElementById(gastosInputs[key].estimado).value = presupuestoActual.gastos[key].estimado || '';
                                document.getElementById(gastosInputs[key].real).value = presupuestoActual.gastos[key].real || '';
                                document.getElementById(gastosInputs[key].fecha).value = presupuestoActual.gastos[key].fecha || '';
                            }
                        }
                       
                        // Cargar gastos extras
                        cargarGastosExtras();
                       
                        mostrarNotificacion(`üìÇ ${getNombreMes(mes)} ${a√±o} cargado`, 'info');
                    } else {
                        // Limpiar todos los campos si no hay datos guardados
                        limpiarCampos();
                        presupuestoActual.extras = [];
                        cargarGastosExtras();
                        mostrarNotificacion(`üÜï Nuevo presupuesto para ${getNombreMes(mes)}`, 'info');
                    }
                   
                    calcularTotales();
                    mostrarCarga(false);
                }, 300);
            }
           
            // Limpiar todos los campos
            function limpiarCampos() {
                // Limpiar ingresos
                for (let key in ingresosInputs) {
                    document.getElementById(ingresosInputs[key].estimado).value = '';
                    document.getElementById(ingresosInputs[key].real).value = '';
                    document.getElementById(ingresosInputs[key].fecha).value = '';
                }
               
                // Limpiar gastos
                for (let key in gastosInputs) {
                    document.getElementById(gastosInputs[key].estimado).value = '';
                    document.getElementById(gastosInputs[key].real).value = '';
                    document.getElementById(gastosInputs[key].fecha).value = '';
                }
               
                // Limpiar extras
                presupuestoActual.extras = [];
                cargarGastosExtras();
               
                // Establecer fechas por defecto (fecha actual)
                const hoyStr = new Date().toISOString().split('T')[0];
                document.querySelectorAll('input[type="date"]').forEach(input => {
                    if (!input.value) input.value = hoyStr;
                });
            }
           
            // Guardar mes en lista de meses disponibles
            function guardarMesDisponible(mes, a√±o) {
                let mesesDisponibles = JSON.parse(localStorage.getItem('meses_disponibles')) || [];
               
                const mesKey = `${a√±o}-${mes}`;
               
                if (!mesesDisponibles.includes(mesKey)) {
                    mesesDisponibles.push(mesKey);
                    localStorage.setItem('meses_disponibles', JSON.stringify(mesesDisponibles));
                }
            }
           
            // Obtener nombre del mes
            function getNombreMes(numeroMes) {
                const meses = [
                    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                ];
                return meses[numeroMes - 1] || 'Desconocido';
            }
           
            // Funciones para gastos extras
            function cargarGastosExtras() {
                const lista = document.getElementById('lista-gastos-extras');
                lista.innerHTML = '';
               
                if (presupuestoActual.extras.length === 0) {
                    lista.innerHTML = '<p style="color: var(--text-secondary); font-style: italic; text-align: center; padding: 20px;">No hay gastos extras registrados.</p>';
                    return;
                }
               
                const tabla = document.createElement('table');
                tabla.className = 'budget-table';
                tabla.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 60%;">Descripci√≥n</th>
                            <th style="width: 25%;">Monto</th>
                            <th style="width: 15%;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="body-gastos-extras"></tbody>
                `;
               
                lista.appendChild(tabla);
                const tbody = document.getElementById('body-gastos-extras');
               
                presupuestoActual.extras.forEach((gasto, index) => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${gasto.descripcion}</td>
                        <td>$${gasto.monto.toFixed(2)}</td>
                        <td>
                            <button class="btn-eliminar-gasto" data-index="${index}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(fila);
                });
               
                // Agregar event listeners a los botones de eliminar
                setTimeout(() => {
                    document.querySelectorAll('.btn-eliminar-gasto').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            eliminarGastoExtra(index);
                        });
                    });
                }, 100);
            }
           
            // Eliminar gasto extra
            function eliminarGastoExtra(index) {
                if (confirm('¬øEliminar este gasto extra?')) {
                    presupuestoActual.extras.splice(index, 1);
                    cargarGastosExtras();
                    calcularTotales();
                    guardarPresupuesto();
                }
            }
           
            // Agregar nuevo gasto extra
            function agregarGastoExtra() {
                const descInput = document.getElementById('nuevo-gasto-desc');
                const montoInput = document.getElementById('nuevo-gasto-monto');
               
                const descripcion = descInput.value.trim();
                const monto = parseFloat(montoInput.value);
               
                if (!descripcion) {
                    mostrarNotificacion('üìù Ingresa una descripci√≥n', 'error');
                    descInput.focus();
                    return;
                }
               
                if (!monto || monto <= 0) {
                    mostrarNotificacion('üí∞ Ingresa un monto v√°lido', 'error');
                    montoInput.focus();
                    return;
                }
               
                presupuestoActual.extras.push({
                    descripcion: descripcion,
                    monto: monto,
                    fecha: new Date().toISOString().split('T')[0]
                });
               
                // Limpiar inputs
                descInput.value = '';
                montoInput.value = '';
               
                // Ocultar teclado en m√≥vil
                descInput.blur();
                montoInput.blur();
               
                // Actualizar interfaz
                cargarGastosExtras();
                calcularTotales();
               
                // Mostrar secci√≥n de gastos extras si estaba oculta
                document.getElementById('gastos-extras-section').style.display = 'block';
               
                mostrarNotificacion('‚úÖ Gasto extra agregado', 'success');
               
                // Guardar autom√°ticamente
                guardarPresupuesto();
            }
           
            // Mostrar notificaci√≥n para m√≥vil
            function mostrarNotificacion(mensaje, tipo) {
                // Eliminar notificaciones anteriores
                document.querySelectorAll('.notificacion').forEach(el => el.remove());
               
                // Crear elemento de notificaci√≥n
                const notificacion = document.createElement('div');
                notificacion.className = 'notificacion';
                notificacion.textContent = mensaje;
               
                // Estilo seg√∫n tipo
                if (tipo === 'success') {
                    notificacion.style.backgroundColor = 'var(--income-color)';
                } else if (tipo === 'error') {
                    notificacion.style.backgroundColor = 'var(--expense-color)';
                } else {
                    notificacion.style.backgroundColor = 'var(--primary)';
                }
               
                document.body.appendChild(notificacion);
               
                // Remover despu√©s de 3 segundos
                setTimeout(() => {
                    notificacion.style.animation = 'slideOutMobile 0.3s ease';
                    setTimeout(() => {
                        if (notificacion.parentNode) {
                            notificacion.parentNode.removeChild(notificacion);
                        }
                    }, 300);
                }, 3000);
            }
           
            // Mostrar/ocultar estado de carga
            function mostrarCarga(mostrar) {
                if (mostrar) {
                    document.body.classList.add('loading');
                } else {
                    document.body.classList.remove('loading');
                }
            }
           
            // EVENT LISTENERS OPTIMIZADOS PARA M√ìVIL
           
            // Calcular autom√°ticamente cuando cambia cualquier campo
            document.querySelectorAll('input[type="number"], input[type="date"]').forEach(input => {
                // Usar input en lugar de change para respuesta inmediata
                input.addEventListener('input', function() {
                    calcularTotales();
                    // Guardar autom√°ticamente despu√©s de un delay
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(guardarPresupuesto, 1000);
                });
            });
           
            // Selectores de mes y a√±o
            selectMonth.addEventListener('change', cargarPresupuestoMes);
            selectYear.addEventListener('change', cargarPresupuestoMes);
           
            // Bot√≥n guardar
            document.getElementById('btn-guardar').addEventListener('click', guardarPresupuesto);
           
            // Bot√≥n cargar
            document.getElementById('btn-cargar').addEventListener('click', cargarPresupuestoMes);
           
            // Bot√≥n limpiar
            document.getElementById('btn-limpiar').addEventListener('click', function() {
                if (confirm('¬øLimpiar todos los campos?\nSe perder√°n los cambios no guardados.')) {
                    limpiarCampos();
                    calcularTotales();
                }
            });
           
            // Bot√≥n agregar gasto extra
            document.getElementById('btn-agregar-gasto').addEventListener('click', function() {
                const seccion = document.getElementById('gastos-extras-section');
                const estaVisible = seccion.style.display !== 'none';
                seccion.style.display = estaVisible ? 'none' : 'block';
               
                if (!estaVisible) {
                    // Enfocar el primer input
                    setTimeout(() => {
                        document.getElementById('nuevo-gasto-desc').focus();
                    }, 300);
                }
            });
           
            // Bot√≥n agregar gasto a la lista
            document.getElementById('btn-agregar-gasto-lista').addEventListener('click', agregarGastoExtra);
           
            // Permitir agregar gasto con Enter
            document.getElementById('nuevo-gasto-desc').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('nuevo-gasto-monto').focus();
                }
            });
           
            document.getElementById('nuevo-gasto-monto').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    agregarGastoExtra();
                }
            });
           
            // Establecer fechas por defecto al cargar
            window.addEventListener('load', function() {
                const hoyStr = new Date().toISOString().split('T')[0];
                document.querySelectorAll('input[type="date"]').forEach(input => {
                    if (!input.value) input.value = hoyStr;
                });
               
                calcularTotales();
               
                // Mostrar mensaje de bienvenida
                setTimeout(() => {
                    mostrarNotificacion('üëã ¬°Bienvenido a tu presupuesto!', 'info');
                }, 1000);
            });
           
            // Prevenir submit accidental en formularios
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                    }
                });
            });
           
            // Mejorar experiencia t√°ctil en tablas
            document.querySelectorAll('.budget-table input').forEach(input => {
                input.addEventListener('touchstart', function(e) {
                    this.focus();
                });
            });
        });
    </script>
</body>
</html>
